<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="libs/reveal.js-3.3.0/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="libs/reveal.js-3.3.0/css/theme/white.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }

  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="style.css"/>
    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'libs/reveal.js-3.3.0/css/print/pdf.css' : 'libs/reveal.js-3.3.0/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <!--[if lt IE 9]>
    <script src="libs/reveal.js-3.3.0/lib/js/html5shiv.js"></script>
    <![endif]-->

</head>
<body>
  <div class="reveal">
    <div class="slides">


<section id="section" class="slide level2">
<h1></h1>
<h3>
Bending Assumptions: Model II and Quantile Regression
</h3>
<p><img src="images/03/simple_regression.jpeg" style="width:40.0%" /><br />
</p>
</section>
<section id="first-a-note" class="slide level2">
<h1>First, a note</h1>
<ul>
<li>To see code, <a href="http://github.com/biol609/biol609.github.io/lectures" class="uri">http://github.com/biol609/biol609.github.io/lectures</a><br />
<br />
</li>
<li>Useful during “lab” so you don’t have to flip through slides<br />
<br />
</li>
<li>.Rmd files, so will have to view “raw”</li>
</ul>
</section>
<section id="sometimes-things-seem-ok-cabezon-spawning-data" class="slide level2">
<h1>Sometimes Things seem OK: Cabezon Spawning Data</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/cabezon_plot-1.jpeg" width="768" /></p>
</section>
<section id="but---those-residuals-are-wide" class="slide level2">
<h1>But - Those Residuals are Wide</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/cab_resid-1.jpeg" width="768" /></p>
<div class="fragment">
What if I told you there is Error in the Mass measurements, too?
</div>
</section>
<section id="food-expenditure-by-income-in-belgium" class="slide level2">
<h1>Food Expenditure by Income in Belgium</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_plot-1.jpeg" width="768" /></p>
</section>
<section id="but---the-trumpet" class="slide level2">
<h1>But - THE TRUMPET!</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_resid-1.jpeg" width="768" /></p>
</section>
<section id="a-robust-outline" class="slide level2">
<h1>A Robust Outline</h1>
<ul>
<li>Model II regression<br />
</li>
<li>Quantile Regression<br />
<br />
Thursday:<br />
</li>
<li>Robust Regression<br />
</li>
<li>Generalized Least Squares</li>
</ul>
</section>
<section id="cabezon-spawning-data" class="slide level2">
<h1>Cabezon Spawning Data</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/cabezon_plot-1.jpeg" width="768" /></p>
</section>
<section id="linear-model-fit" class="slide level2">
<h1>Linear Model Fit</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/cab_lm-1.jpeg" width="768" /></p>
</section>
<section id="assumption-error-only-in-y" class="slide level2">
<h1>Assumption: Error Only in Y</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/err_y-1.jpeg" width="768" /></p>
</section>
<section id="but-what-if-there-is-error-in-x" class="slide level2">
<h1>But What if There is Error in X?</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/err_x-1.jpeg" width="768" /></p>
<div class="fragment">
Can have big biasing effect on slope estimates
</div>
</section>
<section id="really-error-in-both" class="slide level2">
<h1>Really, Error in Both</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/err_both-1.jpeg" width="768" /></p>
</section>
<section id="really-error-in-both-1" class="slide level2">
<h1>Really, Error in Both</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/err_both_ellipse-1.jpeg" width="768" /></p>
</section>
<section id="model-ii-regression" class="slide level2">
<h1>Model II Regression</h1>
<ul>
<li>Estimates best line(s) describing relationship between X and Y with Error In Variables<br />
<br />
</li>
<li>Assumes bivariate normal relationship<br />
<br />
</li>
<li>Not for prediction (use OLS)<br />
<br />
</li>
<li>But can compare slopes, intercepts between groups</li>
</ul>
</section>
<section id="model-ii-regression-when" class="slide level2">
<h1>Model II Regression: When?</h1>
<ul>
<li>Uncertainty in X and Natural Error<br />
<br />
</li>
<li>Common in Allometry<br />
<br />
</li>
<li>Common in Power Law estimation<br />
<br />
</li>
<li>But who doesn’t have that misbehaving scale…</li>
</ul>
</section>
<section id="section-1" class="slide level2">
<h1></h1>
<p><img src="images/03/mod_2_techniques.jpg" /></p>
</section>
<section id="major-axis-regression" class="slide level2">
<h1>Major Axis Regression</h1>
<div id="left">
<p><img src="images/03/ma.jpg" style="width:70.0%" /></p>
</div>
<div id="right">
<ul>
<li>Minimizes sums of squares beetween line and points<br />
<br />
</li>
<li>“Residuals” are perpendicular to fit line<br />
<br />
</li>
<li>Variables should be on same scale</li>
</ul>
</div>
</section>
<section id="standardizedreduced-major-axis-regression" class="slide level2">
<h1>Standardized/Reduced Major Axis Regression</h1>
<div id="left">
<p><img src="images/03/sma.jpg" style="width:70.0%" /></p>
</div>
<div id="right">
<ul>
<li>Minimizes are of triangles with points as right-angle corner<br />
</li>
<li>Variables need not be same scale<br />
<br />
</li>
<li>So, think of it as doing an MA on rescaled variables<br />
</li>
</ul>
</div>
</section>
<section id="when-to-use-what" class="slide level2">
<h1>When to use what</h1>
<p><img src="images/03/which_to_use.jpg" /><br />
<br />
Wharton et al. 2006</p>
</section>
<section id="sma-v.-ma" class="slide level2">
<h1>SMA v. MA</h1>
<p><img src="images/03/sma_v_ma.jpg" /><br />
<br />
Wharton et al. 2006</p>
</section>
<section id="fit-with-smatr" class="slide level2">
<h1>Fit with smatr</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(smatr)
cab_sma &lt;-<span class="st"> </span><span class="kw">sma</span>(No_eggs ~<span class="st"> </span>Mass, <span class="dt">data=</span>eggs)</code></pre></div>
<p>Additional arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">method:<span class="st"> </span>SMA, MA, or OLS
type:<span class="st"> </span>for compring groups
robust:<span class="st"> </span>if outliers present
multcomp:<span class="st"> </span><span class="ot">TRUE</span> to test multiple groups</code></pre></div>
<p>Warton et al. 2012</p>
</section>
<section id="fit-with-smartr" class="slide level2">
<h1>Fit with smartr</h1>
<pre><code>Call: sma(formula = No_eggs ~ Mass, data = eggs) 

Fit using Standardized Major Axis 

------------------------------------------------------------
Coefficients:
            elevation    slope
estimate     12.19378 2.119366
lower limit -11.73415 1.496721
upper limit  36.12172 3.001037

H0 : variables uncorrelated
R-squared : 0.7784851 
P-value : 0.00032417 </code></pre>
</section>
<section id="checking-assumptions" class="slide level2">
<h1>Checking Assumptions</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/unnamed-chunk-2-1.jpeg" width="768" /></p>
</section>
<section id="qq-much-better-behaved" class="slide level2">
<h1>QQ Much Better Behaved</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/unnamed-chunk-3-1.jpeg" width="768" /></p>
</section>
<section id="comparison-of-fits" class="slide level2">
<h1>Comparison of Fits</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/fit_compare-1.jpeg" width="768" /></p>
</section>
<section id="a-robust-outline-1" class="slide level2">
<h1>A Robust Outline</h1>
<ul>
<li>Model II regression<br />
</li>
<li><strong>Quantile Regression</strong><br />
<br />
Thursday:<br />
</li>
<li>Robust Regression<br />
</li>
<li>Generalized Least Squares</li>
</ul>
</section>
<section id="food-expenditure-by-income-in-belgium-1" class="slide level2">
<h1>Food Expenditure by Income in Belgium</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_plot-1.jpeg" width="768" /></p>
</section>
<section id="but---the-trumpet-1" class="slide level2">
<h1>But - THE TRUMPET!</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_resid-1.jpeg" width="768" /></p>
</section>
<section id="regression-through-the-mean" class="slide level2">
<h1>Regression Through the Mean</h1>
<div id="left">
<p><img src="03_rma_quantile_files/figure-revealjs/eng_lm_fit-1.jpeg" width="576" /></p>
</div>
<div id="right">
<ul>
<li>Traditionally, we fit a regression through a mean<br />
<br />
</li>
<li><span class="math inline">\(\hat{y_i} = \beta x_i\)</span> implies the mean value of y at x
<ul>
<li>E[y|x]<br />
</li>
</ul></li>
<li>We can fit through other parts of the distribution</li>
</ul>
</div>
</section>
<section id="regression-through-a-quantile" class="slide level2">
<h1>Regression Through a Quantile</h1>
<div id="left">
<p><img src="03_rma_quantile_files/figure-revealjs/eng_lm_09-1.jpeg" width="576" /></p>
</div>
<div id="right">
<ul>
<li>We can fit through other quantiles<br />
- This is the 0.9 quantile<br />
</li>
<li>90% of the values of y are under the line given X<br />
</li>
<li>This is an optimization problem where residuals are weighted to estimate coefficients</li>
</ul>
</div>
</section>
<section id="regression-through-quantiles" class="slide level2">
<h1>Regression Through Quantiles</h1>
<center>
Red: 0.1, 0.5, and 0.9 quantile
</center>
<p><img src="03_rma_quantile_files/figure-revealjs/eng_lm_quant-1.jpeg" width="768" /></p>
</section>
<section id="regression-through-quantiles-1" class="slide level2">
<h1>Regression Through Quantiles</h1>
<center>
Red: 0.1, 0.5, and 0.9 quantile, Blue: OLS Fit
</center>
<p><img src="03_rma_quantile_files/figure-revealjs/eng_lm_quant_lm-1.jpeg" width="768" /></p>
</section>
<section id="quantile-regression-and-kiddos" class="slide level2">
<h1>Quantile Regression and Kiddos</h1>
<p><img src="images/03/quantile_growth_curve.jpg" /></p>
</section>
<section id="application-very-flexible" class="slide level2">
<h1>Application Very Flexible</h1>
<img src="images/03/nonlinear_plant_rq.jpg" />
<center class="fragment">
Even GLMs are fitting through central tendancy - quantile approaches available
</center>
</section>
<section id="why-quantile-regression" class="slide level2">
<h1>Why Quantile Regression?</h1>
<ul>
<li>Unequal Variation (the trumpet) implies underlying unmeasured drivers &amp; interactions<br />
<br />
</li>
<li>Allows us to see how a relationship varies within a population with no additional covariates<br />
<br />
</li>
<li>Allows us to look at constraints on a population<br />
<br />
</li>
<li>See Cade and Noon 2003</li>
</ul>
</section>
<section id="why-quantile-regression-1" class="slide level2">
<h1>Why Quantile Regression?</h1>
<p><img src="images/03/why_quantreg.jpg" /></p>
</section>
<section id="quantile-regression-with-quantreg" class="slide level2">
<h1>Quantile Regression with Quantreg</h1>
<p>Tau = quantiles<br />
</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(quantreg)
<span class="kw">data</span>(engel)

engel_rq &lt;-<span class="st"> </span><span class="kw">rq</span>(foodexp ~<span class="st"> </span>income, <span class="dt">data=</span>engel,
               <span class="dt">tau =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>))</code></pre></div>
</section>
<section id="quantile-regression-with-quantreg-1" class="slide level2">
<h1>Quantile Regression with Quantreg</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(engel_rq)</code></pre></div>
<pre><code>
Call: rq(formula = foodexp ~ income, tau = c(0.2, 0.5, 0.8), data = engel)

tau: [1] 0.2

Coefficients:
            coefficients lower bd  upper bd 
(Intercept) 102.31388     65.20699 129.07170
income        0.44690      0.40492   0.49542

Call: rq(formula = foodexp ~ income, tau = c(0.2, 0.5, 0.8), data = engel)

tau: [1] 0.5

Coefficients:
            coefficients lower bd  upper bd 
(Intercept)  81.48225     53.25915 114.01156
income        0.56018      0.48702   0.60199

Call: rq(formula = foodexp ~ income, tau = c(0.2, 0.5, 0.8), data = engel)

tau: [1] 0.8

Coefficients:
            coefficients lower bd upper bd
(Intercept) 58.00666     23.44539 97.44950
income       0.65951      0.59454  0.70049</code></pre>
</section>
<section id="broom-summary" class="slide level2">
<h1>Broom Summary</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">broom::<span class="kw">tidy</span>(engel_rq)</code></pre></div>
<pre><code>         term    estimate   conf.low   conf.high tau
1 (Intercept) 102.3138823 60.8322719 136.0809160 0.2
2      income   0.4468995  0.3746126   0.4958588 0.2
3 (Intercept)  81.4822474 47.0904023 135.1883939 0.5
4      income   0.5601806  0.4803301   0.6127786 0.5
5 (Intercept)  58.0066635 18.2035033 111.9660198 0.8
6      income   0.6595106  0.5939093   0.7153737 0.8</code></pre>
</section>
<section id="plotting-lines" class="slide level2">
<h1>Plotting Lines</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">engel_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>engel, <span class="kw">aes</span>(<span class="dt">x=</span>income, <span class="dt">y=</span>foodexp)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size=</span><span class="dv">17</span>)

<span class="co">#STAT_QUANTILE</span>
engel_plot +<span class="st"> </span>
<span class="st">  </span><span class="kw">stat_quantile</span>(<span class="dt">quantiles=</span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>))</code></pre></div>
</section>
<section id="plotting-lines-1" class="slide level2">
<h1>Plotting Lines</h1>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_rq_plot-1.jpeg" width="768" /></p>
</section>
<section id="plotting-coefficients" class="slide level2">
<h1>Plotting Coefficients</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">summary</span>(engel_rq))</code></pre></div>
<p><img src="03_rma_quantile_files/figure-revealjs/engel_coef-1.jpeg" width="768" /></p>
</section>
<section id="lots-of-coefficients" class="slide level2">
<h1>Lots of Coefficients</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">summary</span>(<span class="kw">rq</span>(foodexp ~<span class="st"> </span>income, <span class="dt">data=</span>engel,
               <span class="dt">tau =</span> <span class="kw">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,.<span class="dv">05</span>))))</code></pre></div>
<img src="03_rma_quantile_files/figure-revealjs/engel_all-1.jpeg" width="768" />
<center>
(You can do this in ggplot2, but have to hand-code it)
</center>
</section>
<section id="are-the-coefficients-equal" class="slide level2">
<h1>Are the Coefficients Equal?</h1>
<ul>
<li>We might want to know if there are differences between quantiles of the population.<br />
<br />
</li>
<li>F-Test</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(engel_rq)</code></pre></div>
<pre><code>Quantile Regression Analysis of Deviance Table

Model: foodexp ~ income
Joint Test of Equality of Slopes: tau in {  0.2 0.5 0.8  }

  Df Resid Df F value    Pr(&gt;F)    
1  2      703  21.003 1.382e-09 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</section>
<section id="example-data-for-today" class="slide level2">
<h1>Example Data for Today</h1>
<ul>
<li>ekk_from_dryad.csv from Brennan A, Cross PC, Creel S (2015) Managing more than the mean: using quantile regression to identify factors related to large elk groups. Journal of Applied Ecology<br />
<br />
</li>
<li>What if some of the population abundances have been measured with error? E.g. Wolves v. Elk population size?<br />
<br />
</li>
<li>Where does Quantile regression come in handy in asking what determines elk herd abundance?</li>
</ul>
</section>
    </div>
  </div>

  <script src="libs/reveal.js-3.3.0/lib/js/head.min.js"></script>
  <script src="libs/reveal.js-3.3.0/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Opens links in an iframe preview overlay
        previewLinks: true,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
